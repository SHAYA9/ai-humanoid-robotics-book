"use strict";(globalThis.webpackChunkai_humanoid_robotics_book_new=globalThis.webpackChunkai_humanoid_robotics_book_new||[]).push([[5300],{7064:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"robotics-foundations/the-robot-operating-system-ros-2/synchronous-communication","title":"7.3 Synchronous Communication: Services and Actions","description":"While topics are perfect for continuous data streams, sometimes you need a more direct, synchronous form of communication. For this, ROS 2 provides two powerful mechanisms: Services for quick request/response interactions, and Actions for long-running tasks that require feedback.","source":"@site/docs/01-robotics-foundations/07-the-robot-operating-system-ros-2/03-synchronous-communication.md","sourceDirName":"01-robotics-foundations/07-the-robot-operating-system-ros-2","slug":"/robotics-foundations/the-robot-operating-system-ros-2/synchronous-communication","permalink":"/ai-humanoid-robotics-book/docs/robotics-foundations/the-robot-operating-system-ros-2/synchronous-communication","draft":false,"unlisted":false,"editUrl":"https://github.com/SHAYA9/ai-humanoid-robotics-book/tree/main/docs/01-robotics-foundations/07-the-robot-operating-system-ros-2/03-synchronous-communication.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"7.2 Core Concepts: Nodes, Topics, and Messages","permalink":"/ai-humanoid-robotics-book/docs/robotics-foundations/the-robot-operating-system-ros-2/core-concepts"},"next":{"title":"7.4 Managing Complexity: Launch Files and Parameters","permalink":"/ai-humanoid-robotics-book/docs/robotics-foundations/the-robot-operating-system-ros-2/managing-complexity"}}');var t=s(4848),o=s(8453);const r={sidebar_position:3},c="7.3 Synchronous Communication: Services and Actions",a={},d=[{value:"Services for Request/Response",id:"services-for-requestresponse",level:3},{value:"Example: An &quot;Add Two Ints&quot; Service",id:"example-an-add-two-ints-service",level:4},{value:"Actions for Long-Running, Feedback-Driven Tasks",id:"actions-for-long-running-feedback-driven-tasks",level:3},{value:"Creating Custom Definitions",id:"creating-custom-definitions",level:3}];function l(e){const n={code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"73-synchronous-communication-services-and-actions",children:"7.3 Synchronous Communication: Services and Actions"})}),"\n",(0,t.jsxs)(n.p,{children:["While topics are perfect for continuous data streams, sometimes you need a more direct, synchronous form of communication. For this, ROS 2 provides two powerful mechanisms: ",(0,t.jsx)(n.strong,{children:"Services"})," for quick request/response interactions, and ",(0,t.jsx)(n.strong,{children:"Actions"})," for long-running tasks that require feedback."]}),"\n",(0,t.jsx)(n.h3,{id:"services-for-requestresponse",children:"Services for Request/Response"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"Service"})," is a synchronous, one-to-one communication pattern. It works just like a function call, but between two different nodes."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.strong,{children:"Service Server"})," node advertises a service with a specific name and type. It waits for a request, performs a computation, and sends back a single response."]}),"\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.strong,{children:"Service Client"})," node can call the service by sending a request. It then blocks (waits) until it receives the response from the server."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This is ideal for tasks that are quick and have a clear beginning and end, such as:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Querying the state of a sensor."}),"\n",(0,t.jsx)(n.li,{children:'Triggering a specific, short-lived behavior (e.g., "take a picture").'}),"\n",(0,t.jsx)(n.li,{children:'Requesting a calculation (e.g., "calculate the inverse kinematics for this arm position").'}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"example-an-add-two-ints-service",children:'Example: An "Add Two Ints" Service'}),"\n",(0,t.jsxs)(n.p,{children:["Let's imagine a service that adds two integers. The service definition file (",(0,t.jsx)(n.code,{children:".srv"}),") would look like this:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"AddTwoInts.srv"})})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"int64 a\nint64 b\n---\nint64 sum\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"---"})," separates the request part from the response part."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["Service Server (",(0,t.jsx)(n.code,{children:"add_two_ints_server.py"}),"):"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts # Using a standard example service\n\nclass AddTwoIntsServerNode(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n        self.srv = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_two_ints_callback)\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}. Returning sum={response.sum}')\n        return response\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["Service Client (",(0,t.jsx)(n.code,{children:"add_two_ints_client.py"}),"):"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsClientNode(Node):\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\n        # Wait until the service is available\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.client.call_async(self.req)\n        # We can optionally add a callback to run when the future is complete\n        # rclpy.spin_until_future_complete(self, self.future)\n        return self.future\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When the client calls ",(0,t.jsx)(n.code,{children:"send_request"}),", the server performs the addition and returns the sum."]}),"\n",(0,t.jsx)(n.h3,{id:"actions-for-long-running-feedback-driven-tasks",children:"Actions for Long-Running, Feedback-Driven Tasks"}),"\n",(0,t.jsxs)(n.p,{children:["What if a task takes a long time to complete, like navigating to a goal or assembling a part? A service isn't a good fit because the client would be blocked for the entire duration. This is where ",(0,t.jsx)(n.strong,{children:"Actions"})," come in."]}),"\n",(0,t.jsx)(n.p,{children:"An Action is designed for long-running, asynchronous tasks that can be preempted and provide continuous feedback."}),"\n",(0,t.jsx)(n.p,{children:"The Action communication involves three parts:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Goal:"}),' The client sends a goal to the Action Server (e.g., "navigate to position X, Y").']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Feedback:"}),' While the server is working on the goal, it sends a stream of feedback messages to the client (e.g., "current distance to goal is Z meters").']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Result:"}),' When the task is complete, the server sends a final result (e.g., "succeeded" or "failed").']}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This model is perfect for complex behaviors like:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Robot navigation."}),"\n",(0,t.jsx)(n.li,{children:"Executing a multi-step manipulation task."}),"\n",(0,t.jsx)(n.li,{children:"Processing a large dataset."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The client can also send a cancellation request at any time to stop the task."}),"\n",(0,t.jsx)(n.h3,{id:"creating-custom-definitions",children:"Creating Custom Definitions"}),"\n",(0,t.jsx)(n.p,{children:"Just like with messages, you can define your own services and actions."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Service Definitions (",(0,t.jsx)(n.code,{children:".srv"}),"):"]})," A plain text file with a request part and a response part, separated by ",(0,t.jsx)(n.code,{children:"---"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Action Definitions (",(0,t.jsx)(n.code,{children:".action"}),"):"]})," A plain text file with three parts: the goal, the result, and the feedback, each separated by ",(0,t.jsx)(n.code,{children:"---"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"Fibonacci.action"})})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Goal\nint32 order\n---\n# Result\nint32[] sequence\n---\n# Feedback\nint32[] partial_sequence\n"})}),"\n",(0,t.jsx)(n.p,{children:"These definition files are placed in your ROS 2 package and processed by the build system, making them available to your Python and C++ nodes."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>c});var i=s(6540);const t={},o=i.createContext(t);function r(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);